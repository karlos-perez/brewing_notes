{% extends 'base.html' %}
{% load static brew core qr_code %}

{% block seo %}
  <title>{{ recipe.seo_title }}</title>
  <meta name="description" content="{{ recipe.seo_description }}"/>
  <meta name="keywords" content="{{ recipe.seo_keywords }}"/>
{% endblock %}

{% block head %}
{% if request.user == recipe.user or not recipe.private %}
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&display=swap');
</style>
<link rel="stylesheet" href="{% static 'plugins/fancybox/jquery.fancybox.css' %}"/>
<script src="{% static 'plugins/fancybox/jquery.fancybox.pack.js' %}"></script>
<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<script>
    $(document).ready(function() {
        $('.gallery').fancybox({
            openEffect: 'fade',
            closeEffect: 'fade',
            autoScale: true,
        });
        $('.print-button').on('click', function() {
            window.print();
            return false;
        });
    });
    function RecipePublish(url){
      $('.name-recipe').text('{{ recipe.name }}');
      $('#publish-form').attr('action', url);
      $('#modalPublish').modal('show');
	  };
    function RecipeDelete(url){
      $('.name-recipe').text('{{ recipe.name }}');
      $('#delete-form').attr('action', url);
      $('#modalDelete').modal('show');
	  };

</script>
{% if user.is_pro or user == recipe.user %}
{% if recipe.recipedatalog %}
<script>
  window.onload = function () {
      var dataPointsTemp = [];
      var dataPointsGrav = [];
      var chart = new CanvasJS.Chart("chartContainer", {
          animationEnabled: true,
      	  zoomEnabled: true,
          backgroundColor: null,
          toolTip: {
		          shared: true,
              backgroundColor: "#a8a2a2",
              borderColor: "#a8a2a2",
	        },
          legend: {
              fontColor: "#a8a2a2",
              itemclick: toogleDataSeries,
          },
          axisX:{
              labelFontColor: "#a8a2a2",
              valueFormatString: "DD.MM.YY HH:mm",
          },
          axisY: {
	          	title: "Температура",
	          	titleFontColor: "#a8a2a2",
	          	labelFontColor: "#a8a2a2",
              suffix : " C",
	        },
	        axisY2: {
	          	title: "Плотность",
	          	titleFontColor: "#a8a2a2",
	          	labelFontColor: "#a8a2a2",
	        },
          data: [{
	    	      type: "spline",
	    	      name: "Температура",
	    	      showInLegend: true,
	    	      xValueFormatString: "YYYY.MM.DD HH:mm",
	    	      yValueFormatString: "##.##C",
	    	      dataPoints: dataPointsTemp,
	        },
          {
	          	type: "spline",
	          	name: "Плотность",
	          	axisYType: "secondary",
	          	showInLegend: true,
	          	xValueFormatString: "YYYY.MM.DD HH:mm",
	          	yValueFormatString: "1.###",
	          	dataPoints: dataPointsGrav,
          }],
      });
      chart.render();
      function toogleDataSeries(e){
        	if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
        		  e.dataSeries.visible = false;
        	} else{
        		  e.dataSeries.visible = true;
        	}
        	chart.render();
      }
      function addData(data) {
	        for (var i = 0; i < data.length; i++) {
	            let dt = new Date(data[i].date);
		          dataPointsTemp.push({
			            x: dt,
			            y: data[i].temp,
		          });
		          dataPointsGrav.push({
			            x: dt,
			            y: data[i].grav,
		          });
	        }
	        chart.render();
      }
      $.getJSON("{% url 'get_recipe_chart' recipe.slug %}", addData);
  }
</script>
{% endif %}
{% endif %}
{% endif %}
{% endblock %}

{% block center %}
{% if request.user == recipe.user or not recipe.private %}
<div class="row main-body mb-2 d-print-none">
  <div class="col-12 d-flex justify-content-between py-2">
    <div>
      <a class="link" href="{% url 'recipes_list' %}" title="Рецептурная">
        <span class="small">Список рецептов</span>
      </a>
    </div>
    <div>
      <a class="link" href="{% url 'user_recipes' user.username %}" title="Мои рецепты">
        <span class="small">Мои рецепты</span>
      </a>
      <a class="link ml-2" href="{% url 'user_favorites' user.username %}" title="Избранное">
        <span class="small">Избранное</span>
      </a>
    </div>
  </div>
</div>
<div class="row main-body mb-2 d-print-none">
  <div class="col-12 d-flex justify-content-end">
    <nav class="navbar navbar-expand-sm navbar-dark justify-content-end py-1">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#nav-catalog-collaps" aria-controls="nav-catalog-collaps" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="nav-catalog-collaps">
        <div class="head-menu">
          <ul class="navbar-nav text-right">
            {% if request.user == recipe.user or user.is_moderator %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'recipe_card' recipe.uid %}" title="Карточка рецепта">
                <span class="small d-sm-none mr-2">Карточка рецепта</span>
                <i class="material-icons align-bottom">receipt</i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'recipes_print_lite' recipe.uid %}" title="Компактный вид">
                <span class="small d-sm-none mr-2">Компактный вид</span>
                <i class="material-icons align-bottom">receipt_long</i>
            </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'recipes_brewcard' recipe.slug %}" title="Карта варки">
                <span class="small d-sm-none mr-2">Карта варки</span>
                <i class="material-icons align-bottom">note_alt</i>
              </a>
            </li>
            <li class="nav-item" title="Этикетка на бутылку{% if not user.is_pro %} (Только для Премиум доступа){% endif %}">
              <a class="nav-link{% if not user.is_pro %} disabled{% endif %}" href="{% if user.is_pro %}{% url 'recipe_label' recipe.slug %}{% endif %}">
                <span class="small d-sm-none mr-2">Этикетка</span>
                <i class="material-icons align-bottom">sell</i>
              </a>
            </li>
            {% endif %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'recipes_ingredients' recipe.slug %}" title="Список ингредиентов">
                <span class="small d-sm-none mr-2">Список ингредиентов</span>
                <i class="material-icons align-bottom">&#xe242;</i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link print-button" href="" title="Распечатать">
                <span class="small d-sm-none mr-2">Распечатать</span>
                <i class="material-icons align-bottom">&#xe8ad;</i>
              </a>
            </li>
            <li class="nav-item" title="Скачать PDF{% if not user.is_pro %} (Только для Премиум доступа){% endif %}">
              <a class="nav-link{% if not user.is_pro %} disabled{% endif %}" href="{% if user.is_pro %}{% url 'recipes_pdf' recipe.slug %}{% if recalс != 1 %}?recalc={{ recalc }}{% endif %}{% endif %}">
                <span class="small d-sm-none mr-2">Скачать PDF</span>
                <i class="material-icons align-bottom">picture_as_pdf</i>
              </a>
            </li>
            <li class="nav-item" title="Скачать BeerXML{% if not user.is_pro %} (Только для Премиум доступа){% endif %}">
              <a class="nav-link{% if not user.is_pro %} disabled{% endif %}" href="{% if user.is_pro %}{% url 'recipes_bxml' recipe.slug %}{% endif %}">
                <span class="small d-sm-none mr-2">Скачать BeerXML</span>
                <i class="material-icons align-bottom">save_alt</i>
              </a>
            </li>
            {% if user.ability_to_add %}
            <li class="nav-item">
              <a class="nav-link" href="" title="Скопировать рецепт в черновики" data-toggle="modal" data-target="#modalCopy">
                <span class="small d-sm-none mr-2">Копирование</span>
                <i class="material-icons align-bottom">content_copy</i>
              </a>
            </li>
            {% endif %}
            <li class="nav-item">
              <a class="nav-link" href="" title="Пересчитать рецепт на другой объём" data-toggle="modal" data-target="#modalRecalc">
                <span class="small d-sm-none mr-2">Пересчёт объема</span>
                <i class="material-icons align-bottom">sync</i>
              </a>
            </li>
            {% if request.user == recipe.user or user.is_moderator %}
            <li class="nav-item" title="Анализ рецепта{% if not user.is_pro %} (Только для Премиум доступа){% endif %}">
              <a class="nav-link{% if not user.is_pro %} disabled{% endif %}" href="{% if user.is_pro %}{% url 'recipe_analysis' recipe.slug %}{% endif %}">
                <span class="small d-sm-none mr-2">Анализ рецепта</span>
                <i class="material-icons align-bottom">analytics</i>
              </a>
            </li>
            {% endif %}
            <li class="nav-item" title="Пересчёт рецепта{% if not user.is_pro %} (Только для Премиум доступа){% endif %}">
              <a class="nav-link{% if not user.is_pro %} disabled{% endif %}" href="{% if user.is_pro %}{% url 'create_recipe'%}?recipe={{ recipe.slug }}{% endif %}">
                <span class="small d-sm-none mr-2">Пересчёт рецепта</span>
                <i class="material-icons align-bottom">calculate</i>
              </a>
            </li>
            {% if request.user == recipe.user %}
            <li class="divider-icon-vert d-none d-sm-block"></li>
              {% if request.user.ability_to_add %}
              <li class="nav-item">
                <a class="nav-link" href="{% url 'recipe_add' %}" title="Добавить">
                  <span class="small d-sm-none mr-2">Добавить</span>
                  <i class="material-icons align-bottom">&#xe145;</i>
                </a>
              </li>
              {% endif %}
              {% if recipe.status == 6 %}
              <li class="nav-item">
                <a class="nav-link" href="{% url 'recipe_edit' recipe.slug %}" title="Редактировать">
                  <span class="small d-sm-none mr-2">Редактировать</span>
                  <i class="material-icons align-bottom">&#xe3c9;</i>
                </a>
              </li>
              {% endif %}
              <li class="nav-item">
                <a class="nav-link" href="" title="Поделиться" onclick="RecipeShortURL('{{ recipe.get_short_url }}', '{{ recipe.slug }}', '{{ recipe.get_temp_full_link }}'); return false;">
                  <span class="small d-sm-none mr-2">Поделиться</span>
                  <i class="material-icons align-bottom">&#xe80d;</i>
                </a>
              </li>
              {% if recipe.status == 6 %}
              {% if not recipe.private %}
              <li class="nav-item">
                <a class="nav-link" href="" onclick="RecipePublish('{% url 'recipe_publishing' recipe.slug %}'); return false;" title="Опубликовать">
                  <span class="small d-sm-none mr-2">Опубликовать</span>
                  <i class="material-icons align-bottom">&#xe255;</i>
                </a>
              </li>
              {% endif %}
              <li class="divider-icon-vert d-none d-sm-block"></li>
              <li class="nav-item">
                <a class="nav-link" href="" onclick="RecipeDelete('{% url 'recipe_delete' recipe.slug %}'); return false;" title="Удалить">
                  <span class="small d-sm-none mr-2">Удалить</span>
                  <i class="material-icons align-bottom">&#xe872;</i>
                </a>
              </li>
              {% endif %}
            {% else %}
              {% if recipe.status == 3 %}
              <li class="divider-icon-vert d-none d-sm-block"></li>
              <li class="nav-item">
                <a id="liked-{{ recipe.pk }}" class="nav-link {% if user.pk in recipe.users_liked %}green{% endif %}" href="" onclick="Like('{{ recipe.pk }}','like','{% get_like_url recipe %}'); return false;" title="Нравится">
                  <span class="small d-sm-none mr-2">Нравится</span>
                  <i class="material-icons align-bottom">&#xe8dc;</i>
                </a>
              </li>
              <li class="nav-item">
                <a id="disliked-{{ recipe.pk }}" class="nav-link {% if user.pk in recipe.users_disliked %}red{% endif %}" href="" onclick="Like('{{ recipe.pk }}','dislike','{% get_like_url recipe %}'); return false;" title="Ужасен">
                  <span class="small d-sm-none mr-2">Ужасен</span>
                  <i class="material-icons align-bottom">&#xe8db;</i>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="" onclick="FavoriteSet('{% url 'favorite_recipe' %}', {{ recipe.pk }}); return false;" title="В избраное">
                  {% if is_favorite %}
                  <span class="small d-sm-none mr-2">Убрать из Избранного</span>
                  <i id="favorite-{{ recipe.pk }}" class="material-icons align-bottom">favorite</i>
                  {% else %}
                  <span class="small d-sm-none mr-2">Добавить в Избранное</span>
                  <i id="favorite-{{ recipe.pk }}" class="material-icons align-bottom">favorite_border</i>
                  {% endif %}
                </a>
              </li>
              <li class="divider-icon-vert d-none d-sm-block"></li>
              <li class="nav-item">
                <a class="nav-link" href="" data-toggle="modal" data-target="#modalSend" title="Написать пользователю">
                  <span class="small d-sm-none mr-2">Написать автору</span>
                  <i class="material-icons align-bottom">mail</i>
                </a>
              </li>
              {% endif %}
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
  </div>
</div>
<div class="row">
  <div class="mb-2 pl-3 d-none d-print-block w-100">
    <table class="w-100">
      <tr>
        <td class="w-50">
          {% if recipe.user.obj_pic %}
          <img class="img" src="{{ recipe.user.get_logo }}" height="100" alt="logo">
          {% endif %}
        </td>
        <td class="text-right px-4 w-50 align-top">
          <img class="img" src="{% static 'img/logo_print.png' %}" height="40" alt="logo">
        </td>
      </tr>
    </table>
  </div>
</div>
<div class="row main-body py-3 condensed">
  <div class="col-12 col-sm-9 mb-3">
    <div class="d-flex justify-content-between">
      <div>
        <a class="link" href="{% url 'recipes_list' %}?tp={{ recipe.type }}&st=">
          <span class="h5">{{ recipe.get_type_display }}</span>
        </a>
      </div>
      <div>
        <small>Автор:</small>&nbsp;
        <a class="link" href="{% url 'user_recipes' recipe.user %}">
          <span class="h5">{{ recipe.user }}</span>
        </a>
      </div>
    </div>
    <div>
      <a class="link" href="{% url 'recipe_detail' recipe.slug %}">
        <h3 class="">{% if recipe.brew_number and recipe.user == user %}#{{ recipe.brew_number }}&nbsp;{% endif %}{{ recipe.name }}</h3>
      </a>
    </div>
    <div class="d-flex justify-content-between align-items-center border-line">
      <div class="param">OG&nbsp;<span class="{% if recipe.style.OG_min <= recipe.OG and recipe.OG <= recipe.style.OG_max %}green{% else %}red{% endif %}">{{ recipe.OG|formatted_float }}</span></div>
      <div class="param">FG&nbsp;<span class="{% if recipe.style.FG_min <= recipe.FG and recipe.FG <= recipe.style.FG_max %}green{% else %}red{% endif %}">{{ recipe.FG|formatted_float }}</div>
      <div class="param">ABV&nbsp;<span class="{% if recipe.style.ABV_min <= recipe.abv and recipe.abv <= recipe.style.ABV_max %}green{% else %}red{% endif %}">{{ recipe.abv|floatformat }}%</div>
      <div class="param">IBU&nbsp;<span class="{% if recipe.style.IBUs_min <= recipe.ibu and recipe.ibu <= recipe.style.IBUs_max %}green{% else %}red{% endif %}">{{ recipe.ibu }}</div>
      <div class="param">SRM&nbsp;<span class="{% if recipe.style.SRM_min <= recipe.srm and recipe.srm <= recipe.style.SRM_max %}green{% else %}red{% endif %}">{{ recipe.srm|floatformat }}</div>
    </div>
    <div class="my-1">
      <a class="link" href="{% if recipe.style %}{% url 'style_one' recipe.style.slug %}{% endif %}">
        <span>{{ recipe.style.get_guides_display }}: {{ recipe.style|default_if_none:'---' }}</span>
      </a>
      {% if recipe.style %}
      {% if recipe.status == 3 and recipe.matches_style %}
        <i class="material-icons align-bottom green" title="Рецепт соответствует выбранному стилю">verified</i>
      {% elif recipe.matches_style %}
        <i class="material-icons align-bottom green" title="Параметры рецепта соответствуют выбранному стилю">verified</i>
      {% else %}
        <i class="material-icons align-bottom yellow" title="Рецепт не соответствует выбранному стилю">report</i>
      {% endif %}
      {% endif %}
    </div>
  </div>
  <div class="col-12 col-sm-3 d-flex justify-content-center align-items-center mb-3">
    <div class="d-none d-print-block">
      {% qr_from_text recipe.get_full_short_link size="S" %}
    </div>
    <div class="d-print-none">
    {% if recipe.img %}
      <a class="gallery" rel="pics" href="{{ recipe.img.url|watermark }}">
        <img class="img-thumbnail" src='{{ recipe.get_avatar|thumbnail:"width=150, height=150" }}'>
      </a>
    {% else %}
      <img class="img-thumbnail" src='{{ recipe.get_avatar|thumbnail:"width=150, height=150" }}' style="background-color: {{ srm_color }};">
    {% endif %}
    </div>
  </div>
  <div class="col-12 d-flex justify-content-center mb-3 d-print-none">
    {% for pic in recipe.images %}
    <a class="gallery mx-1" rel="pics" href="{{ pic.img.url }}">
      <img class="img-thumbnail" src="{{ pic.img.url|thumbnail:"height=70" }}" />
    </a>
    {% endfor %}
  </div>

  <div class="col-12 d-flex justify-content-center d-print-none">
    <span class="small ml-1 mr-sm-2">Статус:&nbsp;<strong class="mr-2">{{ recipe.get_status_display }}</strong>&nbsp;{% if recipe.status == 3 %}<strong>{{ recipe.public_date|date:"d.m.Y" }}</strong>{% else %}Создан:&nbsp;<strong>{{ recipe.created_date|date:"d.m.Y" }}</strong>{% endif %}</span>
  </div>
  {% if recipe.status == 3 %}
  <div class="col-12 d-flex justify-content-center">
    <span class="small mx-1 mx-sm-2">Рейтинг:&nbsp;<strong><span id="karma-{{ recipe.pk }}">{{ recipe.karma }}</span></strong></span>
    <span class="small mx-1 mx-sm-2">В&nbsp;Избраном:&nbsp;<strong>{{ recipe.favorites.count }}</strong></span>
    <span class="small ml-1 ml-sm-2">Скопирован:&nbsp;<strong>{{ recipe.views|default_if_none:0 }}</strong></span>
  </div>
  {% endif %}
  <div class="col-12 col-sm-6 px-0 px-sm-3 my-2">
    <div class="head-section px-3 px-sm-0 ">Основные параметры:</div>
    <table class="table-ing my-1">
      <thead>
        <tr>
          <th>Параметры стиля</th>
          <th>Мин</th>
          <th>Рецепт</th>
          <th>Макс</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Начальная плотность</td>
          <td><span>{{ recipe.style.OG_min|formatted_float }}</span></td>
          <td><strong>{{ recipe.OG|gravity_to_plato }}</strong></td>
          <td><span>{{ recipe.style.OG_max|formatted_float }}</span></td>
        </tr>
        <tr>
          <td>Конечная плотность</td>
          <td><span>{{ recipe.style.FG_min|formatted_float }}</span></td>
          <td><strong>{{ recipe.FG|gravity_to_plato }}</strong></td>
          <td><span>{{ recipe.style.FG_max|formatted_float }}</span></td>
        </tr>
        <tr>
          <td>Алкоголь</td>
          <td><span>{{ recipe.style.ABV_min }}</span></td>
          <td><strong>{{ recipe.abv }}&nbsp;%</strong></td>
          <td><span>{{ recipe.style.ABV_max }}</span></td>
        </tr>
        <tr>
          <td>Горечь (IBU)</td>
          <td><span>{{ recipe.style.IBUs_min }}</span></td>
          <td><strong>{{ recipe.ibu }}</strong></td>
          <td><span>{{ recipe.style.IBUs_max }}</span></td>
        </tr>
        <tr>
          <td>Цвет (SRM)</td>
          <td><span>{{ recipe.style.SRM_min }}</span></td>
          <td><strong>{{ recipe.srm }}</strong></td>
          <td><span>{{ recipe.style.SRM_max }}</span></td>
        </tr>
      </tbody>
    </table>
    <table class="table-ing">
      <tbody>
        <tr>
          <td>Размер партии (после кипячения):</td>
          <td><strong>{{ recipe.batch_size|recount:recalc|floatformat }}&nbsp;л</strong></td>
        </tr>
        <tr>
          <td>Время кипячения:</td>
          <td><strong>{{ recipe.boil_time }}&nbsp;мин</strong></td>
        </tr>
        <tr>
          <td>Вода на затор:</td>
          <td><strong>{{ recipe.mash_water|recount:recalc|floatformat }}&nbsp;л</strong></td>
        </tr>
        <tr>
          <td>Вода на промывку:</i></b></td>
          <td><strong>{{ recipe.sparge_water|recount:recalc|floatformat }}&nbsp;л</strong></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="col-12 col-md-6 px-0 px-sm-3 my-2">
    <div class="head-section px-3 px-sm-0">Дополнительные параметры:</div>
    <table class="table-ing my-1">
      <tbody>
        <tr>
          <td>Плотность перед кипячением:</td>
          <td>{% if request.user == recipe.user or user.is_pro %}<strong>{{ recipe.PBG|gravity_to_plato }}</strong>{% else %}<span class="badge badge-secondary ml-2" title="Только для Премиум доступа">Премиум</span>{% endif %}</td>
        </tr>
        <tr>
          <td>Объем на кипячение:</td>
          <td>{% if request.user == recipe.user or user.is_pro %}<strong>{{ recipe.pre_boil_size|recount:recalc|floatformat }}&nbsp;л</strong>{% else %}<span class="badge badge-secondary ml-2" title="Только для Премиум доступа">Премиум</span>{% endif %}</td>
        </tr>
        <tr>
          <td>Осадок после кипячения:</td>
          <td>{% if request.user == recipe.user or user.is_pro %}<strong>{{ recipe.sediment_after_boil|floatformat }}&nbsp;л</strong>{% else %}<span class="badge badge-secondary ml-2" title="Только для Премиум доступа">Премиум</span>{% endif %}</td>
        </tr>
        <tr>
          <td>Объём стартера:</td>
          <td>{% if request.user == recipe.user or user.is_pro %}<strong>{{ recipe.starter_volume|floatformat }}&nbsp;л</strong>{% else %}<span class="badge badge-secondary ml-2" title="Только для Премиум доступа">Премиум</span>{% endif %}</td>
        </tr>
        <tr>
          <td>Объём на розлив:</td>
          <td>{% if request.user == recipe.user or user.is_pro %}<strong>{{ recipe.bottling_size|floatformat }}&nbsp;л</strong>{% else %}<span class="badge badge-secondary ml-2" title="Только для Премиум доступа">Премиум</span>{% endif %}</td>
        </tr>
      </tbody>
    </table>
    <table class="table-ing">
      <tbody>
        <tr>
          <td>Эфф. затирания:</td>
          <td><strong>{{ recipe.efficiency_mash|floatformat }}&nbsp;%</strong></td>
        </tr>
        <tr>
          <td>Аттенюация:</td>
          <td><strong>{{ att|floatformat }}&nbsp;%</strong></td>
        </tr>
        <tr>
          <td>Общий объём воды:</td>
          <td><strong>{{ water_sum|floatformat }}&nbsp;л</strong></td>
        </tr>
        <tr>
          <td>Общий вес зерна:</td>
          <td><strong>{{ grain_sum|recount:recalc|floatformat }}&nbsp;кг</strong></td>
        </tr>
        <tr>
          <td>Общий вес хмеля:</td>
          <td><strong>{{ hop_sum|recount:recalc|floatformat }}&nbsp;г</strong></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="col-12 px-0 px-sm-3 mt-2">
    <div class="head-section px-3 px-sm-0 ">Описание</div>
  </div>
  <div class="col-12">
    {% if recipe.description %}
    <p>{{ recipe.description|linebreaks }}</p>
    {% else %}
    <div class="m-3"></div>
    {% endif %}
  </div>
  <div class="col-12 px-0 px-sm-3">
    <div class="head-section px-3 px-sm-0{% if recalc != 1 %} red" title="Данный раздел не пересчитывался!!!"{% endif %}">Водоподготовка{% if request.user != recipe.user and not user.is_pro  %}<span class="badge badge-secondary ml-2" title="Только для Премиум доступа">Премиум</span>{% endif %}</div>
  </div>
  {% if user == recipe.user or user.is_pro %}
  <div class="col-12 col-md-6 px-0 px-sm-3">
    <table class="table-ing mt-1">
      <thead>
        <tr>
          <th>Добавки</th>
          <th>В заторную воду, г</th>
          <th>В промывочную воду, г</th>
        </tr>
      </thead>
      <tbody>
        {% if recipe.wateringredient_set.all %}
        {% for w in recipe.wateringredient_set.all %}
        {% if w.amount_mash or w.amount_sparge %}
        <tr>
          <td>{{ w.get_additive_display }}{% if w.note %}&nbsp;<sup>{{ forloop.counter }}</sup>{% endif %}</td>
          <td>{{ w.amount_mash|floatformat }}</td>
          <td>{{ w.amount_sparge|floatformat }}</td>
        </tr>
        {% endif %}
        {% endfor %}
        {% else %}
        <tr>
          <td>---</td>
          <td>---</td>
          <td>---</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
    <div class="px-3 px-sm-0">
      {% for w in recipe.wateringredient_set.all %}
      {% if w.note %}
      <small class="mr-2"><strong>{{ forloop.counter }}</strong>.&nbsp;{{ w.note }}</small>
      {% endif %}
      {% endfor %}
    </div>
  </div>
  <div class="col-12 col-md-6 px-0 px-sm-3">
    <table class="table-ing mt-1">
      <thead>
        <tr>
          <th>Профиль воды</th>
          <th class="w50px">Ca<sup>+2</sup></th>
          <th class="w50px">Mg<sup>+2</sup></th>
          <th class="w50px">Na<sup>+</sup></th>
          <th class="w50px">SO<sub>4</sub><sup>-2</sup></th>
          <th class="w50px">Cl<sup>-</sup></th>
          <th class="w50px">HCO<sub>3</sub><sup>-</sup></th>
          <th class="w50px">PH</th>
        </tr>
      </thead>
      <tbody>
        {% if recipe.wateroriginalprofile %}
        <tr>
          <td>Исходный{% if recipe.wateroriginalprofile.note %}*{% endif %}</td>
          <td>{{ recipe.wateroriginalprofile.calcum|default_if_none:'0' }}</td>
          <td>{{ recipe.wateroriginalprofile.magnesium|default_if_none:'0' }}</td>
          <td>{{ recipe.wateroriginalprofile.sodium|default_if_none:'0' }}</td>
          <td>{{ recipe.wateroriginalprofile.sulfate|default_if_none:'0' }}</td>
          <td>{{ recipe.wateroriginalprofile.chloride|default_if_none:'0' }}</td>
          <td>{{ recipe.wateroriginalprofile.bicarbonate|default_if_none:'0' }}</td>
          <td>{{ recipe.wateroriginalprofile.ph|default_if_none:'0' }}</td>
        </tr>
        {% endif %}
        <tr>
          <td>Целевой{% if recipe.watertargetprofile.note %}*{% endif %}</td>
          {% if recipe.watertargetprofile %}
          <td>{{ recipe.watertargetprofile.calcum|default_if_none:'0' }}</td>
          <td>{{ recipe.watertargetprofile.magnesium|default_if_none:'0' }}</td>
          <td>{{ recipe.watertargetprofile.sodium|default_if_none:'0' }}</td>
          <td>{{ recipe.watertargetprofile.sulfate|default_if_none:'0' }}</td>
          <td>{{ recipe.watertargetprofile.chloride|default_if_none:'0' }}</td>
          <td>{{ recipe.watertargetprofile.bicarbonate|default_if_none:'0' }}</td>
          <td>{{ recipe.watertargetprofile.ph|default_if_none:'0' }}</td>
          {% else %}
          <td>---</td>
          <td>---</td>
          <td>---</td>
          <td>---</td>
          <td>---</td>
          <td>---</td>
          <td>---</td>
          {% endif %}
        </tr>
      </tbody>
    </table>
    <div class="px-3 px-sm-0">
      {% if recipe.wateroriginalprofile.note %}
      <div class="mb-2">
        <small class=""><strong>*Исходный:</strong>&nbsp;{{ recipe.wateroriginalprofile.note }}</small>
      </div>
      {% endif %}
      {% if recipe.watertargetprofile.note %}
      <div class="mb-2">
        <small class="mb-2"><strong>*Целевой:</strong>&nbsp;{{ recipe.watertargetprofile.note }}</small>
      </div>
      {% endif %}
    </div>
  </div>
  {% else %}
  <div class="col-12 px-0 px-sm-3 ">
    <div class="m-3"></div>
  </div>
  {% endif %}
  <div class="col-12 px-0 px-sm-3 ">
    <div class="head-section px-3 px-sm-0 ">Затирание</div>
    <table class="table-ing mt-1">
      <thead>
        <tr>
          <th>Внесение</th>
          <th class="d-none d-lg-table-cell">Категория</th>
          <th>Наименование</th>
          <th>Кол-во</th>
        </tr>
      </thead>
      <tbody>
      {% for i in mash %}
        <tr>
          <td>{{ i.get_use_display }}</td>
          <td class="d-none d-lg-table-cell">{{ i.ingredient.get_type_display }}</td>
          <td><a class="link" href="{{ i.ingredient.get_absolute_url }}" title="{{ i.ingredient.company }}">{{ i.ingredient }}</a>{% if i.note %}&nbsp;<sup>{{ forloop.counter }}</sup>{% endif %}</td>
          <td><strong>{{ i.amount|recount:recalc }}&nbsp;{% if i.measure %}{{ i.get_measure_display }}{% else %}кг{% endif %}</strong>&nbsp;{% if i in recipe.grainingredients_set.all %}({{ i.amount|proportion:grain_sum }}%){% endif %}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    <div class="px-3 px-sm-0 mb-2">
    {% for i in mash %}
    {% if i.note %}
      <small class="mr-2"><strong>{{ forloop.counter }}</strong>.&nbsp;{{ i.note }}</small>
    {% endif %}
    {% endfor %}
    </div>
  </div>
  <div class="col-12 px-0 px-sm-3 mt-2">
    <div class="head-section px-3 px-sm-0 ">Шаги затирания:</div>
    <table class="table-ing mt-1">
      <thead>
        <tr>
          <th>Пауза</th>
          <th>Температура</th>
          <th>Длительность</th>
          <th class="d-none d-sm-table-cell">Нагрев</th>
        </tr>
      </thead>
      <tbody>
      {% for m in recipe.mashguidelines_set.all %}
        <tr>
          <td>{{ m.get_type_rest_display }}{% if m.note %}&nbsp;<sup>{{ forloop.counter }}</sup>{% endif %}</td>
          <td>{{ m.step_temp }} &deg;C</td>
          <td>{{ m.step_time }} мин</td>
          <td class="d-none d-sm-table-cell">{{ m.get_type_mash_display }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    <div class="px-3 px-sm-0 mb-2">
    {% for m in recipe.mashguidelines_set.all %}
    {% if m.note %}
      <small class="mr-2"><strong>{{ forloop.counter }}</strong>.&nbsp;{{ m.note }}</small>
    {% endif %}
    {% endfor %}
    </div>
  </div>
  {% if boil %}
  <div class="col-12 px-0 px-sm-3 mt-2">
    <div class="head-section px-3 px-sm-0">Варка:</div>
    <table class="table-ing mt-1">
      <thead>
        <tr>
          <th class="d-none d-md-table-cell">Категория</th>
          <th class="d-none d-lg-table-cell">Тип</th>
          <th>Наименование</th>
          <th>Кол-во</th>
          <th>Время</th>
        </tr>
      </thead>
      <tbody>
      {% for i in boil %}
        <tr>
          <td class="d-none d-md-table-cell">{{ i.ingredient|verbose_name|default_if_none:'---' }}</td>
          <td class="d-none d-lg-table-cell">{{ i.ingredient.get_type_display }}</td>
          <td>{% if i.alfa %}<a class="link" href="{% url 'hop_one' i.ingredient.slug %}">{{ i.ingredient }}&nbsp;({{ i.alfa }}%)</a>{% else %}{{ i.ingredient|default_if_none:'---' }}{% endif %}{% if i.note %}&nbsp;<sup>{{ forloop.counter }}</sup>{% endif %}</td>
          <td>{{ i.amount|recount:recalc }}&nbsp;{% if i.measure %}{{ i.get_measure_display }}{% else %}г{% endif %}</td>
          <td>{{ i.time }}&nbsp;мин</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    <div class="px-3 px-sm-0 mb-2">
    {% for i in boil %}
    {% if i.note %}
      <small class="mr-2"><strong>{{ forloop.counter }}</strong>.&nbsp;{{ i.note }}</small>
    {% endif %}
    {% endfor %}
    </div>
  </div>
  {% endif %}
  {% if chilling %}
  <div class="col-12 px-0 px-sm-3 mt-2">
    <div class="head-section px-3 px-sm-0 ">Охлаждение:</div>
    <table class="table-ing mt-1">
      <thead>
        <tr>
          <th class="d-none d-md-table-cell">Категория</th>
          <th class="d-none d-lg-table-cell">Тип</th>
          <th>Наименование</th>
          <th>Кол-во</th>
          <th>Т.&deg;C</th>
          <th>Время</th>
        </tr>
      </thead>
      <tbody>
      {% for i in chilling %}
        <tr>
          <td class="d-none d-md-table-cell">{{ i.ingredient|verbose_name|default_if_none:'---' }}</td>
          <td class="d-none d-lg-table-cell">{{ i.ingredient.get_type_display }}</td>
          <td>{% if i.alfa %}<a class="link" href="{% url 'hop_one' i.ingredient.slug %}">{{ i.ingredient }}&nbsp;({{ i.alfa }}%)</a>{% else %}{{ i.ingredient|default_if_none:'---' }}{% endif%}{% if i.note %}&nbsp;<sup>{{ forloop.counter }}</sup>{% endif %}</td>
          <td>{{ i.amount|recount:recalc }}&nbsp;{% if i.measure %}{{ i.get_measure_display }}{% else %}г{% endif %}</td>
          <td>{{ i.temp|default_if_none:'---'  }}</td>
          <td>{{ i.time }}&nbsp;мин</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    <div class="px-3 px-sm-0 mb-2">
    {% for i in chilling %}
    {% if i.note %}
      <small class="mr-2"><strong>{{ forloop.counter }}</strong>.&nbsp;{{ i.note }}</small>
    {% endif %}
    {% endfor %}
    </div>
  </div>
  {% endif %}
  <div class="col-12 px-0 px-sm-3 mt-2">
    <div class="head-section px-3 px-sm-0{% if recalc != 1 %} red" title="Данный раздел не пересчитывался!!!"{% endif %}">Сбраживание:</div>
    <table class="table-ing mt-1">
      <thead>
        <tr>
          <th class="d-none d-md-table-cell">Категория</th>
          <th class="d-none d-lg-table-cell">Тип</th>
          <th>Наименование</th>
          <th>Количество</th>
          <th>Длит.</th>
        </tr>
      </thead>
      <tbody>
      {% for i in recipe.yeastsingredients_set.all %}
        <tr>
          <td class="d-none d-md-table-cell">{{ i.ingredient|verbose_name }}&nbsp;{% if i.ingredient.its_dry %}<i class="material-icons" style="vertical-align: bottom;" title="Сухие">grain</i>{% else %}<i class="material-icons" style="vertical-align: bottom;" title="Жидкие">water</i>{% endif %}</td>
          <td class="d-none d-lg-table-cell">{{ i.ingredient.get_type_display }}</td>
          <td><a class="link" href="{% url 'yeast_one' i.ingredient.slug %}">{{ i.ingredient.name }} ({{ i.ingredient.short_name }}){% if i.note %}&nbsp;<sup>{{ forloop.counter }}y</sup>{% endif %}</a></td>
          <td {% if recalc != 1 %}class="red"{% endif %}>{{ i.amount|recount:recalc|floatformat }} {{ i.get_measure_display }}</td>
          <td>---</td>
        </tr>
      {% endfor %}
      {% if dry_hop %}
        {% for i in dry_hop %}
        <tr>
          <td class="d-none d-md-table-cell">{{ i.ingredient|verbose_name|default_if_none:'---' }}</td>
          <td class="d-none d-lg-table-cell">{{ i.ingredient.get_type_display }}</td>
          <td>{% if i.alfa %}<a class="link" href="{% url 'hop_one' i.ingredient.slug %}">{{ i.ingredient }} ({{ i.alfa }}%)</a>{% else %}{{ i.ingredient|default_if_none:'---' }}{% endif %}{% if i.note %}&nbsp;<sup>{{ forloop.counter }}</sup>{% endif %}</td>
          <td>{{ i.amount|recount:recalc }}&nbsp;{% if i.measure %}{{ i.get_measure_display }}{% else %}г{% endif %}</td>
          <td>{{ i.time }} дн</td>
        </tr>
      {% endfor %}
      {% endif %}
      </tbody>
    </table>
    <div class="px-3 px-sm-0">
    {% for i in recipe.yeastsingredients_set.all %}
    {% if i.note %}
      <small class="mr-2"><strong>{{ forloop.counter }}y</strong>.&nbsp;{{ i.note }}</small>
    {% endif %}
    {% endfor %}
    </div>
    <div class="px-3 px-sm-0">
    {% for i in dry_hop %}
    {% if i.note %}
      <small class="mr-2"><strong>{{ forloop.counter }}</strong>.&nbsp;{{ i.note }}</small>
    {% endif %}
    {% endfor %}
    </div>
  </div>
  <div class="col-12 px-0 px-sm-3 mt-2">
    <div class="head-section px-3 px-sm-0{% if recalc != 1 %} red" title="Данный раздел не пересчитывался!!!"{% endif %}">Карбонизация:</div>
    <table class="table-ing mt-1">
      <thead>
        <tr>
          <th>Метод</th>
          <th>Количество</th>
          {% if recipe.priming.temp %}<th>Температура партии</th>{% endif %}
          {% if recipe.priming.CO2_level %}<th>Уровень CO<sub>2</sub></th>{% endif %}
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>{{ recipe.priming.get_priming_method_display }}{% if recipe.priming.note %}&nbsp;<sup>*</sup>{% endif %}</td>
          <td {% if recalc != 1 %}class="red"{% endif %}>{{ recipe.priming.amount }} {{ recipe.priming.get_measure_display }}</td>
          {% if recipe.priming.temp %}<td>{{ recipe.priming.temp }}&nbsp;&deg;C</td>{% endif %}
          {% if recipe.priming.CO2_level %}<td>{{ recipe.priming.CO2_level }}</td>{% endif %}
        </tr>
      </tbody>
    </table>
    <div class="px-3 px-sm-0">
    {% if recipe.priming.note %}
      <small class=""><strong>*</strong>&nbsp;{{ recipe.priming.note }}</small>
    {% endif %}
    </div>
  </div>
  {% if recipe.fermentationguidelines_set.all %}
  <div class="col-12 {% if recipe.recipedatalog %}col-sm-6 {% endif %}px-0 px-sm-3 mt-2">
    <div class="head-section px-3 px-sm-0">Рекомендации по ферментации:{% if request.user != recipe.user and not user.is_pro  %}<span class="badge badge-secondary ml-2" title="Только для Премиум доступа">Премиум</span>{% endif %}</div>
    {% if request.user == recipe.user or user.is_pro %}
    <table class="table-ing mt-1">
      <thead>
        <tr>
          <th>№</th>
          <th>&deg;C</th>
          <th>Дни</th>
          <th>Этап</th>
        </tr>
      </thead>
      <tbody>
        {% for i in recipe.fermentationguidelines_set.all %}
        <tr>
          <td>{{ i.order }}</td>
          <td>{{ i.temp }}</td>
          <td>{{ i.duration }}</td>
          <td>{{ i.get_stage_display }}{% if i.note %}<sup>{{ forloop.counter }}</sup>{% endif %}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="px-3 px-sm-0 mb-2">
    {% for i in recipe.fermentationguidelines_set.all %}
      {% if i.note %}
      <small class="mr-2"><strong>{{ forloop.counter }}</strong>.&nbsp;{{ i.note }}</small>
      {% endif %}
    {% endfor %}
    </div>
    {% endif %}
  </div>
  {% endif %}
  {% if recipe.recipedatalog %}
  <div class="col-12 {% if recipe.fermentationguidelines_set.all %}col-sm-6 {% endif %}px-0 px-sm-3 mt-2">
    <div class="head-section px-3 px-sm-0">График брожения:{% if request.user != recipe.user and not user.is_pro  %}<span class="badge badge-secondary ml-2" title="Только для Премиум доступа">Премиум</span>{% endif %}</div>
    {% if request.user == recipe.user or user.is_pro %}
    <div id="chartContainer" style="height: 270px; width: 100%;"></div>
    {% else %}
    <div class="m-3"></div>
    {% endif %}
  </div>
  {% endif %}
  {% if recipe.show_log or user == recipe.user %}
  {% if recipe.brewinglog_set.all %}
  <div class="col-12 px-0 px-sm-3 mt-2">
    <div class="head-section px-3 px-sm-0">Дневник рецепта:{% if request.user != recipe.user and not user.is_pro  %}<span class="badge badge-secondary ml-2" title="Только для Премиум доступа">Премиум</span>{% endif %}</div>
    {% if request.user == recipe.user or user.is_pro %}
    <table class="table-ing mt-1">
      <thead>
        <tr>
          <th class="w-auto">Дата</th>
          <th class="w-auto">Событие</th>
          <th>Примечание</th>
        </tr>
      </thead>
      <tbody>
        {% for i in recipe.brewinglog_set.all %}
        <tr>
          <td class="w-auto">{{ i.date|date:"d.m.Y" }}</td>
          <td class="w-auto">{{ i.get_event_display }}</td>
          <td><small>{{ i.note }}</small></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endif %}
  </div>
  {% endif %}
  {% endif %}
  {% if recipe.show_note or user == recipe.user %}
  {% if recipe.note %}
  <div class="col-12 px-0 px-sm-3 mt-2">
    <div class="head-section px-3 px-sm-0 ">Заметки к рецепту:</div>
  </div>
  <div class="col-12">
    {{ recipe.note|linebreaks }}
  </div>
  {% endif %}
  {% endif %}
  <div class="col-12 px-0 px-sm-3 mt-2">
    <div class="d-flex justify-content-between border-line-top">
      <div class="px-3 px-sm-0">
        <span class="">Составил рецепт: <a class="link" href="{% url 'user_recipes' recipe.user %}"><b>{{ recipe.user }}</b></a></span>
      </div>
      <div class="d-none d-print-block">
        <span class="text-right">{{ recipe.get_full_short_link }}</span>
      </div>
      <div class="d-print-none px-3 px-sm-0">
        {% if recipe.url_source %}
        <a class="link " href="{{ recipe.url_source }}"><strong>Источник</strong></a>
        {% endif %}
        {% if recipe.url_discussion %}
        <a class="link ml-sm-2" href="{{ recipe.url_discussion }}"><strong>Обсуждение</strong></a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% else %}
  {% include 'recipe/recipe_private.html' %}
{% endif %}
{% endblock %}

{% block modal %}
<div class="modal fade" id="modalCopy" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Копирование рецепта</h3>
      </div>
      <div class="modal-body">
        <form id="copy-form" action="{% url 'recipes_copy' recipe.slug %}" method="post">{% csrf_token %}
          <div class="form-row mt-2">
            <div class="form-group">
            <label class="mr-2">Пересчитать рецепт на объем:</label>
            <input type="number" name="new_batch_size" min="10" step="0.1" value="{{ recipe.batch_size }}">
            </div>
            <small><b class="red">Внимание!!!</b> При пересчете рецепта на другой размер партии, не пересчитываются данные разделов Карбонизация и Подготовка воды. В данные этих разделов необходимо рассчитывать и вносить вручную в зависимости от личных предпочтений.</small>
          </div>
          <div class="form-group mt-2 text-right">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
            <button type="submit" class="btn btn-dark">Копировать</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="modalRecalc" tabindex="-1" aria-hidden="true">
  <script>
    function updateRecalc() {
        if ($("#radioVolume").prop("checked")) {
            $('#new-volume').prop('disabled', false);
            $('#new-weight').prop('disabled', true);
        }
        if ($("#radioWeight").prop("checked")) {
            $('#new-volume').prop('disabled', true);
            $('#new-weight').prop('disabled', false);
        }
    }
  </script>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
          <h3>Пересчёт рецепта на другой объём</h3>
      </div>
      <div class="modal-body">
        <form id="recalc-form" method="get">
          <div class="form-row d-flex justify-content-between">
            <div class="m-3">
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="new" id="radioVolume" value="volume" onchange="javascript: updateRecalc();" checked>
                <label class="form-check-label" for="radioVolume">Объём партии</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="new" id="radioWeight" value="weight" onchange="javascript: updateRecalc();">
                <label class="form-check-label" for="radioWeight">Вес засыпи</label>
              </div>
            </div>
            <div class="form-group">
              <label class="mr-2">Новый размер партии, л:</label>
              <input id="new-volume" type="number" name="value" min="10" step="0.1" value="{{ recipe.batch_size }}">
            </div>
            <div class="form-group">
              <label class="mr-2">Новый вес, кг:</label>
              <input disabled id="new-weight" type="number" name="value" min="1" step="0.1" value="{{ grain_sum }}">
            </div>
            <small><b class="red">Внимание!!!</b> При пересчете рецепта на другой размер партии, не пересчитываются данные разделов Карбонизация и Подготовка воды. В данные этих разделов необходимо рассчитывать и вносить вручную в зависимости от личных предпочтений. Данные по разделу "Сбраживание" тоже необходимо откорректировать в зависимости от нормы задачи дрожжей.</small>
          </div>
          <div class="form-group mt-2 text-right">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
            <button type="submit" class="btn btn-dark">Пересчитать</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="modalDelete" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <p>Вы уверены, что хотите удалить: "<span class="name-recipe"></span>"?</p>
      </div>
      <div class="modal-footer">
        <form id="delete-form" action="">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
          <button type="submit" class="btn btn-dark">Удалить</button>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="modalPublish" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <p>Вы уверены, что хотите опубликовать рецепт: "<span class="name-recipe"></span>"?</p>
        <p>После публиковании рецепта в общественный доступ нельзя будет его отредактировать или удалить и он становится «Общественным достоянием»</p>
      </div>
      <div class="modal-footer justify-content-start">
        <form id="publish-form" class="col" action="" method="post">{% csrf_token %}
          <div class="form-group form-check">
            <input id="agree" type="checkbox" name="consent" class="form-check-input">
            <label class="form-check-label" for="agree"><small>Принимаю <a class="link" href="{% url 'regulations' %}" target="_blank">Правила публикации рецептов</a></small></label>
          </div>
          <div class="form-group">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
            <button id="plublish" type="submit" class="btn btn-dark">Опубликовать</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="modalSend" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5>Быстрое сообщение пользователю {{ recipe.user }}</h5>
      </div>
      <div class="modal-body">
        <form method="post">{% csrf_token %}
          <div class="form-group">
            <label>Тема сообщения</label>
            <input id="send-subject" class="form-control"  type="text" name="subject"/>
          </div>
          <div class="form-group">
            <textarea id="send-message" class="form-control" name="message"></textarea>
          </div>
          <div class="form-group">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
            <button onclick="SendMessage('{% url 'push_message' recipe.user.pk %}', {{ recipe.user.pk }}); return false;" type="button" class="btn btn-dark">Отправить</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  $(document).ready(function(){
    $('#login-signup-modal').modal('show');
    $('#plublish').prop('disabled', true);
    $('#agree').change(function() {
      $('#plublish').prop('disabled', function(i, val) {
        return !val;
      })
    });
  });
</script>
{% include 'blocks/modal_short_link.html' %}
{% endblock %}